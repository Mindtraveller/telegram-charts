function createButtons(e,n){const o=addClass(el("div"),"buttons");on(o,"click",function(t){const e=t.target.dataset.chart;if(!e)return;const o={...s,[e]:!s[e]};if(!Object.values(o).some(t=>t))return;t.target.classList.toggle("m-hidden"),emit(n,"visibility-updated",s=o)});let s=Object.keys(e.names).reduce((t,e)=>({...t,[e]:!0}),{});return Object.keys(e.names).forEach(n=>{const s=el("button"),i=svgEl("svg",{width:"20",height:"20",viewBox:"0 0 24 24"});i.style.borderColor=e.colors[n],i.style.background=e.colors[n],add(i,svgEl("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"})),add(s,i);const a=el("span");add(a,t(e.names[n])),add(s,a),s.dataset.chart=n,add(o,s)}),{buttons:o,visibilityMap:s}}function createChart(e){const n=document.getElementById("charts-container"),o=Math.min(500,window.innerWidth),s=400,i=50,a=20,r=5,d=.95,c=10*o/500,l=e.columns[0].slice(1),u={...e,columns:e.columns.slice(1),lines:{}},f=Math.round(l.length/c/6),h=addClass(el("div"),"chart-wrapper"),m=svgEl("svg",{viewBox:`0 0 ${o} ${s+a}`}),{preview:g,previewContainer:v}=function(){const t=addClass(el("div"),"preview-container"),e=svgEl("svg",{viewBox:`0 0 ${o} ${i}`});return add(t,e),add(t,createSlider(u,h)),{previewContainer:t,preview:e}}();let{buttons:p,visibilityMap:C}=createButtons(u,h);const{selectedPointInfo:w,pointChartValues:x,pointDate:E}=function(){const e=el("div");addClass(e,"point-info");const n=el("div");addClass(n,"charts-info");const o=el("div");add(e,o),add(e,n);const s=Object.entries(u.names).reduce((e,[o,s])=>{const i=el("div");i.style.color=u.colors[o],addClass(i,"info");const a=el("span");return add(i,a),e[o]=a,add(i,t(s)),add(n,i),e},{});return{selectedPointInfo:e,pointChartValues:s,pointDate:o}}();let y,M,{xAxes:b,xAxesHidden:B}=function(){const t=svgEl("g");addClass(t,"x-axes");const e=svgEl("g");return addClass(e,"x-axes","hidden"),{xAxes:t,xAxesHidden:e}}();add(m,b),add(m,B),add(h,m),add(h,v),add(h,p),add(h,w),add(n,h);let k,A,N,$=0,I=void 0,D=-1,L=0,T=0,X=u.columns.filter(t=>C[t[0]]),S=J(),_=K(l,o),P=q(X),j=V(X),H=Z($,I),O=et();function W(){if(P===L)return;const t=Math.ceil(P*d/(r-1)),e=Array.apply(null,Array(r-1)).map((e,n)=>(n+1)*t),n=Q(e,st(e),s*d);U(M),n.forEach((t,n)=>{const s=rt(10,o-10,t+a,t+a),i=dt(e[e.length-n-1],5,t);add(M,s),add(M,i)}),removeClass(M,"m-down","m-up"),removeClass(y,"m-down","m-up"),addClass(M,P>L?"m-up":"m-down","pending"),addClass(y,P>L?"m-down":"m-up","pending");const i=M;M=y,y=i,setTimeout(()=>{removeClass(y,"hidden","pending"),removeClass(M,"pending"),addClass(M,"hidden")},0)}function z(){if(k&&(m.removeChild(k),k=null),-1===D)return w.style.display="none",void u.columns.forEach(t=>{const e=t[0];u.lines[e].chartPoint.style.animationName="exit"});const t=l[D],e=o*(t-l[$])/(l[I-1]-l[$]);k=rt(e,e,a,a+s),u.columns.forEach(t=>{const n=t[0],o=t.slice(1),i=Q(o,L,s,a),r=u.lines[n].chartPoint;r.style.animationName=C[n]?"enter":"exit",svgAttrs(r,{cx:e});const d=r.firstChild;svgAttrs(d,{from:d.getAttribute("to"),to:i[D]}),d.beginElement(),x[n].innerText=o[D],x[n].parentElement.style.display=C[n]?"flex":"none"}),m.insertBefore(k,m.firstChild),E.innerText=new Date(t).toString().slice(0,10);const n=e>o/2;w.style[n?"right":"left"]=`${n?o-e:e}px`,w.style[n?"left":"right"]=null,w.style.display="block"}function V(t){return st(t.reduce((t,e)=>t.concat(e.slice(1)),[]))}function q(t){return st(t.reduce((t,e)=>t.concat(e.slice(1+$,I?1+I:void 0)),[]))}function F(t=!1){ot(X,(e,n)=>{const o=e.slice(1);G(u.lines[n],o),t&&R(u.lines[n],o)})}function R(t,e,n){const o=Q(e,j,i),s=Q(e,T,i);Y(t.preview,_,o,s,n)}function G(t,e,n){const o=e.slice($,I),i=Q(o,P,s,a),r=Q(o,L,s,a);Y(t.chart,S,i,r,n)}function J(){return K(l.slice($,I),o)}function K(t,e){const n=Math.min(...t),o=st(t),s=Math.abs(o-n);return t.map(t=>e*(t-n)/s)}function Q(t,e,n,o=0){return t.map(t=>e?n*t/e+o:o)}function U(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function Y(t,e,n,o,s=1){const i=t.firstChild;svgAttrs(i,{from:e.reduce((t,e,n)=>t+`${e},${o[n]} `,""),to:e.reduce((t,e,o)=>t+`${e},${n[o]} `,"")}),t.style.animationName=s?"enter":"exit",i.beginElement()}function Z(t,e=l.length){const n=Math.round(10*(e-t)/l.length);return Math.round(Math.log2(n))}function tt(){return Math.ceil(f*Math.pow(2,H))}function et(){const t=[],e=tt();for(let n=0;n<l.length;n+=e)t.push(nt(l[n]));return t}function nt(t){const e=new Date(t).toString().slice(4,10);return"0"===e[4]?`${e.slice(0,4)}${e[5]}`:e}function ot(t,e){t.forEach(t=>e(t,t[0]))}function st(t){return Math.max(...t)}function it(t="points"){return svgEl("animate",{attributeName:t,repeatCount:1,dur:"250ms",fill:"freeze",from:0,to:0})}function at(t,e){return svgEl("polyline",{fill:"none",stroke:t,"stroke-width":e})}function rt(t,e,n,o){return svgEl("line",{x1:t,y1:n,x2:e,y2:o,fill:"gray",stroke:"gray","stroke-width":.3})}function dt(t,e,n){const o=svgEl("text",{x:e,y:n});return o.textContent=t,o}ot(X,(t,e)=>{const n=u.colors[e],o=at(n,2.5),s=at(n,1.5),i=svgEl("circle",{r:6,fill:"white",stroke:n,"stroke-width":2.5});i.style.animationName="exit",u.lines[e]={chart:o,preview:s,chartPoint:i},add(o,it()),add(s,it()),add(i,it("cy")),add(m,o),add(m,i),add(g,s)}),function(){const t=svgEl("g"),e=svgEl("g");addClass(t,"y-axes"),addClass(e,"y-axes","hidden"),m.insertBefore(t,m.firstChild),m.insertBefore(e,m.firstChild),m.insertBefore(function(){const t=svgEl("g"),e=rt(10,o-10,a,a),n=dt("0",5,-a);return add(t,e),add(t,n),t}(),m.firstChild),y=t,M=e}(),F(!0),W(),L=P,T=j,on(h,"visibility-updated",({detail:t})=>{A=t,N=u.columns.filter(t=>A[t[0]]),P=q(N),j=V(N),ot(N.length>X.length?N:X,(t,e)=>{const n=t.slice(1),o=A[e]?1:0;G(u.lines[e],n,o),R(u.lines[e],n,o)}),W(),C=A,L=P,T=j,X=N,z()}),on(h,"border-changed",({detail:{start:t,end:e}})=>{const n=Z(t,e);n!==H&&(H=n,console.log(H),O=et(),function(t,e,n,o){const s=t!==e,i=n!==o,a=n>o,r=b;b=B,B=r,addClass(b,"pending"),removeClass(b,"hidden","right"),addClass(B,"hidden"),removeClass(B,"pending","right"),!i||a||s||addClass(B,"right")}($,t,I,e)),$=t,I=e,S=J(),P=q(X),F(),W(),function(){U(b);const t=tt();let e=1;for(;($+e)%t!=0;)e++;for(let n=e;n<S.length-1;n+=t){const e=dt(O[($+n)/t],S[n],0);add(b,e)}}(),L=P,z()}),on(m,"click",t=>{const e=t.offsetX,n=S[1]/2,o=$+Math.max(0,S.findIndex(t=>t+n>e));o!==D&&(D=o,z())}),on(document,"click",t=>{h.contains(t.target)||(D=-1,z())})}function el(t){return document.createElement(t)}function t(t){return document.createTextNode(t)}function svgEl(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg",t);return svgAttrs(n,e),n}function svgAttrs(t,e={}){Object.entries(e).forEach(([e,n])=>{t.setAttributeNS(null,e,n)})}function addClass(t,...e){return t.classList.add(...e),t}function removeClass(t,...e){t.classList.remove(...e)}function add(t,e){t.appendChild(e)}function on(t,e,n){t.addEventListener(e,n)}function off(t,e,n){t.removeEventListener(e,n)}function emit(t,e,n){t.dispatchEvent(new CustomEvent(e,{detail:n}))}(()=>{const t="Switch to Night Mode",e="Switch to Day Mode";let n=!1;const o=document.getElementById("mode-switcher");on(o,"click",function(){document.body.classList.toggle("dark"),n=!n,o.innerText=n?e:t}),o.innerText=t})();const MIN_WIDTH=50;function createSlider(t,e){const n=t.columns[0].slice(1),{slider:o,leftBar:s,rightBar:i}=function(){const t=addClass(el("div"),"slider"),e=addClass(el("div"),"slider__bar"),n=addClass(el("div"),"slider__bar","right");return add(t,e),add(t,n),{slider:t,leftBar:e,rightBar:n}}(),a=A("left"),r=A("right");let d;on(s,"touchstart",C),on(s,"mousedown",C),on(o,"touchstart",g),on(o,"mousedown",g),on(i,"touchstart",C),on(i,"mousedown",C);let c,l,u,f=0,h=0,m={start:-1,end:-1};function g(t){u=t.touches?t.touches[0].clientX:t.clientX,on(t.target,"touchmove",v),on(t.target.parentElement,"mousemove",v),on(t.target,"touchend",p),window.onmouseup=(()=>p(t))}function v(t){t.preventDefault();const e=t.touches?t.touches[0].clientX:t.clientX,n=u-e,o=Math.max(0,c-n),s=Math.max(0,f+n);y(o,s)&&(M(o),b(s),k())}function p(t){E(),off(t.target,"touchmove",v),off(t.target.parentElement,"mousemove",v),off(t.target,"touchend",p),window.onmouseup=void 0}function C(t){u=t.touches?t.touches[0].clientX:t.clientX;const e=t.target===s;t.target.ontouchmove=(t=>w(t,e)),t.target.parentElement.parentElement.onmousemove=(t=>w(t,e)),on(t.target,"touchend",x),window.onmouseup=(()=>x(t)),t.stopPropagation()}function w(t,e){t.preventDefault();const n=t.touches?t.touches[0].clientX:t.clientX,o=u-n,s=e?Math.max(0,c-o):l,i=e?h:Math.max(0,f+o);y(s,i)&&(e?M(s):b(i),k())}function x(t){E(),t.target.onmousemove=void 0,t.target.parentElement.parentElement.onmousemove=void 0,off(t.target,"touchend",x),window.onmouseup=void 0}function E(){y()&&(f=h,c=l)}function y(t=l,e=h){return d-t-e>=MIN_WIDTH}function M(t){l=t,B(a,t)}function b(t){h=t,B(r,t)}function B(t,e){t.style.width=`${e}px`}function k(){const t={start:Math.max(0,Math.floor(l*n.length/d)),end:Math.min(n.length-1,Math.round((d-h)*n.length/d))};m.start===t.start&&m.end===t.end||(m=t,emit(e,"border-changed",t))}function A(t){return addClass(el("div"),"shadow",t)}requestAnimationFrame(()=>{d=o.parentElement.getBoundingClientRect().width,l=d-MIN_WIDTH,b(h),M(l),E(),k()});const N=addClass(el("div"),"slider-container");return add(N,a),add(N,o),add(N,r),N}