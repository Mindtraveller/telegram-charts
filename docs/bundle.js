function createBarChart(e,t){let n=Math.min(400,window.innerWidth),l=350,a=n-20,i=50,r=20,o=6,s=10*n/400,c=t.columns[0].slice(1),u={...t,columns:t.columns.slice(1).map(e=>({name:e[0],data:e.slice(1)})),lines:{}},f=Math.round(c.length/s/6),h=svgEl("svg",{viewBox:`0 0 ${n} ${l+r}`}),m=createCanvas(n,l),{preview:g,previewContainer:v}=function(){let t=el("div","preview-container"),n=createCanvas(a,i);return add(t,n,createSlider(c,e)),{previewContainer:t,preview:n}}(),{selectedPointInfo:x,pointChartValues:p,pointDate:y}=createSelectedPointInfo(u),{xAxes:C,xAxesHidden:w}={xAxes:svgEl("g",{},"x-axes"),xAxesHidden:svgEl("g",{},"x-axes","hidden")},{yAxesGroupShown:E,yAxesGroupHidden:A}=function(){let e=svgEl("g",{},"y-axes"),t=svgEl("g",{},"y-axes","hidden");return[e,t].forEach(e=>{for(let t=0;t<o;t++)add(e,K("",5,0))}),{yAxesGroupShown:e,yAxesGroupHidden:t}}(),M=el("div","charts");add(M,m,h,v,x),add(h,function(){let e=svgEl("g",{},"y-axes"),t=Math.ceil(l/o);for(let a=0;a<o;a++){let i=svgEl("line",{x1:10,y1:l-t*a,x2:n-10,y2:l-t*a,fill:"gray",stroke:"gray","stroke-width":.3});add(e,i)}return e}(),E,A,C,w),add(e,M);let b=0,D=c.length,S=-1,k=0,B=u.columns,T=V(),L=R(c,n),F=H(B),P=Y(B.reduce((e,t)=>e.concat(t.data),[]));let N=z(b,D),G=j(N),I=null;function O(){if(-1===S||S<b||S>D)return void(x.style.display="none");let e=c[S],t=n*(e-c[b])/(c[D]-c[b]);U(u.columns,(e,t)=>{p[t].value.innerText=formatPointValue(e[S]),p[t].value.parentElement.style.display="flex"}),y.innerText=new Date(e).toString().slice(0,15);let l=t>n/2;x.style.transform="translateX("+(l?t-200:t+20)+"px)",x.style.display="block"}function H(e){return Y(e.reduce((e,t)=>e.concat(t.data.slice(b,D+1)),[]))}function $(e=!1){U(B,(t,r)=>{!function(e,t){let a=X(t.slice(b,D+1),F,l),i=n/T.length;if(-1===S)return void _(e.color,T,a,i);if(S>=b&&S<=D)return _("#8cbef5",T.slice(0,S-b),a.slice(0,S-b),i),_("#8cbef5",T.slice(S-b+1),a.slice(S-b+1),i),void _("#558DED",[T[S-b]],[a[S-b]],i);_("#8cbef5",T,a,i)}(u.lines[r],t),e&&function(e,t,n){let l=X(t,P,i);r=e,o=L,s=l,drawBars(g,o,s,r.color,a/o.length);var r,o,s}(u.lines[r],t)})}function V(){return R(c.slice(b,D+1),n)}function R(e,t){let n=e[0],l=e[e.length-1],a=Math.abs(l-n);return e.map(e=>t*(e-n)/a)}function X(e,t,n,l=0,a=0){let i=e.slice(0);for(let r=0;r<e.length;r++)i[r]=t?n*(i[r]-a)/(t-a)+l:l;return i}function _(e,t,n,l){drawBars(m,t,n,e,l)}function z(e,t){let n=Math.round(10*(t-e)/c.length);return Math.round(Math.log2(n))}function W(e){return Math.ceil(f*Math.pow(2,e))}function j(e){let t=[],n=W(e);for(let e=0;e<c.length;e+=n)t.push(q(c[e]));return t}function q(e){let t=new Date(e).toString().slice(4,10);return"0"===t[4]?`${t.slice(0,4)}${t[5]}`:t}function U(e,t){e.forEach(e=>t(e.data,e.name))}function Y(e){return Math.max(...e)}function K(e,t,n){let l=svgEl("text",{x:t,y:n,"font-size":13});return l.textContent=e,l}U(B,(e,t)=>{let n=u.colors[t];u.lines[t]={color:n}}),$(!0),on(e,"border-changed",({detail:{start:e,end:t}})=>{let a=z(e,t);if(a!==N&&(G=j(a),function(e,t,n,l,a,i){let r=a!==i;if(n===l||!r){let n=C;C=w,w=n,addClass(C,"pending",r?"right":"",t>e?"even":""),removeClass(C,r?"":"right",t>e?"":"even"),addClass(w,r?"right":""),removeClass(w,"even",t>e?"pending":"",r?"":"right"),setTimeout(()=>{removeClass(C,"hidden"),addClass(w,"hidden")},0)}}(N,a,b,e,D,t),N=a),clearCanvas(m),b=e,D=t,T=V(),F=H(B),$(),!I){let e=k;I=setTimeout(()=>{!function(e,t){if(t===e)return;let n=Math.ceil(t/o),a=Array.apply(null,Array(o)).map((e,t)=>t*n),i=X(a,t,l),r=A.childNodes;i.reverse().forEach((e,t)=>{let n=r[t];n.textContent=formatAxisValue(a[a.length-t-1]),svgAttrs(n,{x:5,y:l-e-5})}),removeClass(A,"m-down","m-up"),removeClass(E,"m-down","m-up"),addClass(A,t>e?"m-up":"m-down","pending"),addClass(E,t>e?"m-down":"m-up","pending");let s=A;A=E,E=s,setTimeout(()=>{removeClass(E,"hidden","pending"),removeClass(A,"pending"),addClass(A,"hidden")},0)}(e,F),I=null},250)}k=F,function(){clearChildren(C);let e=W(N),t=1;for(;(b+t)%e!=0;)t++;if((b+t)%(2*e)!=0){let a=(b+t-e)/(2*e),i=n*(c[a]-c[b])/(c[D]-c[b]),o=K(G[a],i,l+r-5);add(C,o)}for(let n=t;n<T.length-1;n+=e){let t=K(G[(b+n)/e],T[n],l+r-5);add(C,t)}}(),O()}),on(h,"click",e=>{let t=n/T.length,l=b+Math.max(0,T.findIndex(n=>n+t>e.offsetX));l!==S&&(S=l,clearCanvas(m),$(),O())}),on(d,"click",t=>{e.contains(t.target)||(S=-1,clearCanvas(m),$(),O())})}function createBarStackedChart(e,t){let n=Math.min(400,window.innerWidth),l=350,a=n-20,i=50,r=150,o=.5,s=20,c=6,u=10*n/400,f=t.columns[0].slice(1),h={...t,columns:t.columns.slice(1).map(e=>({name:e[0],data:e.slice(1)})),lines:{}},m=Math.round(f.length/u/6),g=svgEl("svg",{viewBox:`0 0 ${n} ${l+s}`}),v=createCanvas(n,l),{preview:x,previewContainer:p}=function(){let t=el("div","preview-container"),n=createCanvas(a,i);return add(t,n,createSlider(f,e)),{previewContainer:t,preview:n}}(),{buttons:y,visibilityMap:C}=createButtons(h,e),{selectedPointInfo:w,pointChartValues:E,pointDate:A}=createSelectedPointInfo(h),{xAxes:M,xAxesHidden:b}={xAxes:svgEl("g",{},"x-axes"),xAxesHidden:svgEl("g",{},"x-axes","hidden")},{yAxesGroupShown:D,yAxesGroupHidden:S}=function(){let e=svgEl("g",{},"y-axes"),t=svgEl("g",{},"y-axes","hidden");return[e,t].forEach(e=>{for(let t=0;t<c;t++)add(e,de("",5,0))}),{yAxesGroupShown:e,yAxesGroupHidden:t}}(),k=el("div","charts");add(k,v,g,p,w),add(g,function(){let e=svgEl("g"),t=Math.ceil(l/c);for(let a=0;a<c;a++){let i=l-t*a,r=svgEl("line",{x1:10,y1:i,x2:n-10,y2:i,fill:"gray",stroke:"gray","stroke-width":.3});add(e,r)}return e}(),D,S,M,b),add(e,k,y);let B=0,T=f.length,L=-1,F=0,P=h.columns,N=Q(),G=Z(f,n),I=Y(P),O=U(P),H=le(B,T),$=ie(H),V=null;oe(P,(e,t)=>{let n=h.colors[t];h.lines[t]={color:n}});let R,X=q(P);!function(e){oe(P,(t,n)=>{!function(e,t){let n=ee(t,O,i);ne(getLineColor(e.color),G,n)}(h.lines[n],e[n])})}(X);let _=O;function z(e,t){if(t===e)return;let n=Math.ceil(t/c),a=Array.apply(null,Array(c)).map((e,t)=>t*n),i=ee(a,t,l),r=S.childNodes;i.reverse().forEach((e,t)=>{let n=r[t];n.textContent=formatAxisValue(a[a.length-t-1]),svgAttrs(n,{x:5,y:l-e-5})}),removeClass(S,"m-down","m-up"),removeClass(D,"m-down","m-up"),addClass(S,t>e?"m-up":"m-down","pending"),addClass(D,t>e?"m-down":"m-up","pending");let o=S;S=D,D=o,setTimeout(()=>{removeClass(D,"hidden","pending"),removeClass(S,"pending"),addClass(S,"hidden")},0)}function W(){if(-1===L||L<B||L>T)return void(w.style.display="none");let e=f[L],t=n*(e-f[B])/(f[T]-f[B]);oe(h.columns,(e,t)=>{E[t].value.innerText=formatPointValue(e[L]),E[t].value.parentElement.style.display=C[t]?"flex":"none"}),A.innerText=new Date(e).toString().slice(0,15);let l=t>n/2;w.style.transform="translateX("+(l?t-200:t+20)+"px)",w.style.display="block"}function j(e){let t=e.reduce((e,t)=>(e[t.name]=[],e),{});for(let n=B;n<T+1;n++)for(let l=0;l<e.length;l++){let a=e[l],i=e[l-1],r=i?t[i.name][2*(n-B)]+t[i.name][2*(n-B)+1]:0,o=a.data[n];t[a.name].push(r),t[a.name].push(o)}return t}function q(e){let t=e.reduce((e,t)=>(e[t.name]=[],e),{});for(let n=0;n<f.length;n++)for(let l=0;l<e.length;l++){let a=e[l],i=e[l-1],r=i?t[i.name][2*n]+t[i.name][2*n+1]:0,o=a.data[n];t[a.name].push(r),t[a.name].push(o)}return t}function U(e){let t=[];for(let n=0;n<f.length;n++)t.push(e.reduce((e,t)=>e+t.data[n],0));return se(t)}function Y(e){let t=[];for(let n=B;n<T+1;n++)t.push(e.reduce((e,t)=>e+t.data[n],0));return se(t)}function K(e){oe(P,(t,n)=>{J(h.lines[n],e[n],I)})}function J(e,t,a){let i=ee(t,a,l);if(width=n/(i.length/2),-1!==L)return L>=B&&L<=T?(te(getLineColor(e.color),N.slice(0,L-B),i.slice(0,2*L-2*B),width,o),te(getLineColor(e.color),N.slice(L-B+1),i.slice(2*L-2*B+2),width,o),void te(getLineColor(e.color),[N[L-B]],[i[2*L-2*B],i[2*L-2*B+1]],width)):void te(getLineColor(e.color),N,i,width,o);te(getLineColor(e.color),N,i,width)}function Q(){return Z(f.slice(B,T+1),n)}function Z(e,t){let n=e[0],l=e[e.length-1],a=Math.abs(l-n);return e.map(e=>t*(e-n)/a)}function ee(e,t,n,l=0,a=0){let i=e.slice(0);for(let r=0;r<e.length;r++)i[r]=t?n*(i[r]-a)/(t-a)+l:l;return i}function te(e,t,n,l,a){drawStackedBars(v,t,n,e,l,a)}function ne(e,t,n){drawStackedBars(x,t,n,e,a/t.length)}function le(e,t){let n=Math.round(10*(t-e)/f.length);return Math.round(Math.log2(n))}function ae(e){return Math.ceil(m*Math.pow(2,e))}function ie(e){let t=[],n=ae(e);for(let e=0;e<f.length;e+=n)t.push(re(f[e]));return t}function re(e){let t=new Date(e).toString().slice(4,10);return"0"===t[4]?`${t.slice(0,4)}${t[5]}`:t}function oe(e,t){e.forEach(e=>t(e.data,e.name))}function se(e){return Math.max(...e)}function de(e,t,n){let l=svgEl("text",{x:t,y:n,"font-size":13});return l.textContent=e,l}on(e,"visibility-updated",({detail:e})=>{C=e;let t=h.columns.filter(e=>C[e.name]),n=q(t);I=Y(t),z(F,I),O=U(t),function(e,t,n,l,a,o){let s={},d=e.concat(t).filter(e=>{let t=s[e.name];return s[e.name]=!0,!t}).sort((e,t)=>e.name>t.name?-1:e.name===t.name?0:1);scheduleAnimation(e=>{clearCanvas(v),clearCanvas(x);for(let r=0;r<d.length;r++){let s=d[r].name,c=h.lines[s],u=!t.find(e=>e.name===s),f=!C[s],m=[];if(u){m=n[s].slice(0);for(let t=0;t<m.length-1;t+=2)m[t+1]=m[t+1]*e}else if(f){m=l[s].slice(0);for(let t=0;t<m.length-1;t+=2)m[t]=m[t]-m[t]*e,m[t+1]=m[t+1]*(1-e)}else{m=n[s].slice(0);let t=l[s];for(let n=0;n<m.length-1;n+=2)m[n]=t[n]+(m[n]-t[n])*e,m[n+1]=t[n+1]+(m[n+1]-t[n+1])*e}J(c,m.slice(2*B,2*T+2),o+(a-o)*e);let g=ee(m,o+(a-o)*e,i);ne(c.color,G,g)}},r)}(t,P,n,X,O,_),F=I,_=O,X=n,P=t,W()}),on(e,"border-changed",({detail:{start:e,end:t}})=>{let a=le(e,t);if(a!==H&&($=ie(a),function(e,t,n,l,a,i){let r=a!==i;if(n===l||!r){let n=M;M=b,b=n,addClass(M,"pending",r?"right":"",t>e?"even":""),removeClass(M,r?"":"right",t>e?"":"even"),addClass(b,r?"right":""),removeClass(b,"even",t>e?"pending":"",r?"":"right"),setTimeout(()=>{removeClass(M,"hidden"),addClass(b,"hidden")},0)}}(H,a,B,e,T,t),H=a),clearCanvas(v),B=e,T=t,N=Q(),I=Y(P),K(R=j(P)),!V){let e=F;V=setTimeout(()=>{z(e,I),V=null},r)}F=I,function(){clearChildren(M);let e=ae(H),t=1;for(;(B+t)%e!=0;)t++;if((B+t)%(2*e)!=0){let a=(B+t-e)/(2*e),i=n*(f[a]-f[B])/(f[T]-f[B]),r=de($[a],i,l+s-5);add(M,r)}for(let n=t;n<N.length-1;n+=e){let t=de($[(B+n)/e],N[n],l+s-5);add(M,t)}}(),W()}),on(g,"click",e=>{let t=N[1]/2,n=B+Math.max(0,N.findIndex(n=>n+t>e.offsetX));n!==L&&(L=n,clearCanvas(v),K(R=j(P)),W())}),on(d,"click",t=>{if(!e.contains(t.target)){let e=-1;e!==L&&(L=e,clearCanvas(v),K(R=j(P)),W())}})}function createDoubleYLineChart(e,t){let n=Math.min(400,window.innerWidth),l=350,a=n-20,i=50,r=2,o=1,s=250,c=20,u=6,f=10*n/400,h=t.columns[0].slice(1),m={...t,columns:t.columns.slice(1).map(e=>({name:e[0],data:e.slice(1)})),lines:{}},g=Math.round(h.length/f/6),v=svgEl("svg",{viewBox:`0 0 ${n} ${l+c}`}),x=createCanvas(n,l),{preview:p,previewContainer:y}=function(){let t=el("div","preview-container"),n=createCanvas(a,i);return add(t,n,createSlider(h,e)),{previewContainer:t,preview:n}}(),{buttons:C,visibilityMap:w}=createButtons(m,e),{selectedPointInfo:E,pointChartValues:A,pointDate:M}=createSelectedPointInfo(m),{xAxes:b,xAxesHidden:D}={xAxes:svgEl("g",{},"x-axes"),xAxesHidden:svgEl("g",{},"x-axes","hidden")},{yAxesGroupShown:S,yAxesGroupHidden:k,yAxesRightGroupShown:B,yAxesRightGroupHidden:T}=function(){let e=svgEl("g",{},"y-axes"),n=svgEl("g",{},"y-axes","hidden");[e,n].forEach(e=>{for(let n=0;n<u;n++){let n=oe("",5,0);svgAttrs(n,{fill:t.colors.y0}),add(e,n)}});let l=svgEl("g",{},"y-axes","m-right"),a=svgEl("g",{},"y-axes","m-right","hidden");return[l,a].forEach(e=>{for(let n=0;n<u;n++){let n=oe("",5,0);svgAttrs(n,{fill:t.colors.y1}),add(e,n)}}),{yAxesGroupShown:e,yAxesGroupHidden:n,yAxesRightGroupShown:l,yAxesRightGroupHidden:a}}(),L=function(){let e=svgEl("g",{},"y-axes"),t=Math.ceil(l/u);for(let a=0;a<u;a++){let i=re(10,n-10,l-t*a,l-t*a);add(e,i)}return e}(),F=re(0,0,0,l),P=el("div","charts");add(P,x,v,y,E),add(v,F,L,S,k,B,T,b,D),add(e,P,C);let N=0,G=h.length,I=-1,O=m.columns,H=U(),$=Y(h,n),V={y0:{min:0,max:0},y1:{min:0,max:0}},R=q(O);O.forEach(e=>e.yMax={max:ae(e.data),min:ie(e.data)});let X=Z(N,G),_=te(X),z=null;function W(e,t,a){le(m.columns,(i,r)=>{let o="y1"===r,s=o?T:k,d=o?B:S;if(!w[r])return removeClass(d,"m-down"),void addClass(d,"hidden","m-up");if(e[r]&&t[r].max===e[r].max&&t[r].min===e[r].min&&a[r]&&w[r])return;let c=Math.ceil((t[r].max-t[r].min)/u),f=Array.apply(null,Array(u)).map((e,n)=>t[r].min+n*c),h=K(f,t[r].max,l,0,t[r].min).reverse(),m=k.childNodes,g=T.childNodes;if(h.forEach((e,t)=>{let a=o?g[t]:m[t];a.textContent=formatAxisValue(f[f.length-t-1]),svgAttrs(a,{x:o?n-7*(a.textContent.length+1):5,y:l-e-5})}),removeClass(s,"m-down","m-up"),removeClass(d,"m-down","m-up"),addClass(s,e[r]&&t[r].max>e[r].max?"m-up":"m-down","pending"),addClass(d,e[r]&&t[r].max>e[r].max?"m-down":"m-up","pending"),o){let e=T;T=B,B=e}else{k=S,S=s}setTimeout(()=>{removeClass(s,"hidden","pending"),removeClass(d,"pending"),addClass(d,"hidden")},0)})}function j(){if(-1===I||I<N||I>G)return F.style.display="none",E.style.display="none",void le(m.columns,(e,t)=>{m.lines[t].chartPoint.style.animationName="exit"});let e=h[I],t=n*(e-h[N])/(h[G]-h[N]);svgAttrs(F,{x1:t,x2:t}),le(m.columns,(e,n)=>{let a=K([e[I]],V[n].max,l,c,V[n].min)[0],i=m.lines[n].chartPoint;i.style.animationName=w[n]?"enter":"exit",svgAttrs(i,{cx:t});let r=i.firstChild;svgAttrs(r,{from:r.getAttribute("to"),to:a}),r.beginElement(),A[n].value.innerText=formatPointValue(e[I]),A[n].value.parentElement.style.display=w[n]?"flex":"none"}),M.innerText=new Date(e).toString().slice(0,15);let a=t>n/2;E.style.transform="translateX("+(a?t-200:t+20)+"px)",E.style.display="block",F.style.display="block"}function q(e){return e.reduce((e,t)=>{let n=t.data.slice(N,G+1);return e[t.name]={max:ae(n),min:ie(n)},e},{})}function U(){return Y(h.slice(N,G+1),n)}function Y(e,t){let n=e[0],l=e[e.length-1],a=Math.abs(l-n);return e.map(e=>t*(e-n)/a)}function K(e,t,n,l=0,a=0){let i=e.slice(0);for(let r=0;r<e.length;r++)i[r]=t?n*(i[r]-a)/(t-a)+l:l;return i}function J(e,t,n,l=1){drawLine(x,t,n,e.color,l,r)}function Q(e,t,n,l=1){drawLine(p,t,n,e.color,l,o)}function Z(e,t){let n=Math.round(10*(t-e)/h.length);return Math.round(Math.log2(n))}function ee(e){return Math.ceil(g*Math.pow(2,e))}function te(e){let t=[],n=ee(e);for(let e=0;e<h.length;e+=n)t.push(ne(h[e]));return t}function ne(e){let t=new Date(e).toString().slice(4,10);return"0"===t[4]?`${t.slice(0,4)}${t[5]}`:t}function le(e,t){e.forEach(e=>t(e.data,e.name,e))}function ae(e){return Math.max(...e)}function ie(e){return Math.min(...e)}function re(e,t,n,l){return svgEl("line",{x1:e,y1:n,x2:t,y2:l,fill:"gray",stroke:"gray","stroke-width":.3})}function oe(e,t,n){let l=svgEl("text",{x:t,y:n,"font-size":13});return l.textContent=e,l}le(O,(e,t)=>{let n=m.colors[t],l=svgEl("circle",{r:6,fill:"white",stroke:n,"stroke-width":r});l.style.animationName="exit",m.lines[t]={chartPoint:l,color:n},add(l,function(e="points"){return svgEl("animate",{attributeName:e,repeatCount:1,dur:"250ms",fill:"freeze",from:0,to:0})}("cy")),add(v,l)}),le(O,(e,t,n)=>{!function(e,t,n,l){let a=K(t,n.max,i,0,n.min);Q(e,$,a,l)}(m.lines[t],e,n.yMax)}),on(e,"visibility-updated",({detail:e})=>{let t=w;w=e;let n=m.columns.filter(e=>w[e.name]);R=q(m.columns),function(e,t,n){let a=e.length>=O.length?e:t;scheduleAnimation(e=>{clearCanvas(x),clearCanvas(p),le(a,(a,r,o)=>{let s=m.lines[r],d=1,c=i,u=l,f=!t.find(e=>e.name===r),h=!w[r];f?(d=Math.min(1,2*e),c*=1-e+1,u*=1-e+1):h&&(d=Math.max(0,1-2*e),u+=u*e,c+=c*e);let g=a.slice(N,G+1),v=K(g,n[r].max,u,0,n[r].min);J(s,H,v,d);let x=K(a,o.yMax.max,c,0,o.yMax.min);Q(s,$,x,d)})},s)}(n,O,R),W(V,R,t),V=R,O=n,j()}),on(e,"border-changed",({detail:{start:e,end:t}})=>{let a=Z(e,t);if(a!==X&&(_=te(a),function(e,t,n,l,a,i){let r=a!==i;if(n===l||!r){let n=b;b=D,D=n,addClass(b,"pending",r?"right":"",t>e?"even":""),removeClass(b,r?"":"right",t>e?"":"even"),addClass(D,r?"right":""),removeClass(D,"even",t>e?"pending":"",r?"":"right"),setTimeout(()=>{removeClass(b,"hidden"),addClass(D,"hidden")},0)}}(X,a,N,e,G,t),X=a),clearCanvas(x),N=e,G=t,H=U(),R=q(O),le(O,(e,t,n)=>{!function(e,t,n,a){let i=K(t.slice(N,G+1),n.max,l,0,n.min);J(e,H,i,a)}(m.lines[t],e,R[t])}),!z){let e=V;z=setTimeout(()=>{W(e,R,w),z=null},s)}V=R,function(){clearChildren(b);let e=ee(X),t=1;for(;(N+t)%e!=0;)t++;if((N+t)%(2*e)!=0){let a=(N+t-e)/(2*e),i=n*(h[a]-h[N])/(h[G]-h[N]),r=oe(_[a],i,l+c-5);add(b,r)}for(let n=t;n<H.length-1;n+=e){let t=oe(_[(N+n)/e],H[n],l+c-5);add(b,t)}}(),j()}),on(v,"click",e=>{let t=H[1]/2,n=N+Math.max(0,H.findIndex(n=>n+t>e.offsetX));n!==I&&(I=n,j())}),on(d,"click",t=>{e.contains(t.target)||(I=-1,j())})}function createLineChart(e,t){let n=Math.min(400,window.innerWidth),l=350,a=n-20,i=50,r=2,o=1,s=250,c=20,u=6,f=10*n/400,h=t.columns[0].slice(1),m={...t,columns:t.columns.slice(1).map(e=>({name:e[0],data:e.slice(1)})),lines:{}},g=Math.round(h.length/f/6),v=svgEl("svg",{viewBox:`0 0 ${n} ${l+c}`}),x=createCanvas(n,l),{preview:p,previewContainer:y}=function(){let t=el("div","preview-container"),n=createCanvas(a,i);return add(t,n,createSlider(h,e)),{previewContainer:t,preview:n}}(),{buttons:C,visibilityMap:w}=createButtons(m,e),{selectedPointInfo:E,pointChartValues:A,pointDate:M}=createSelectedPointInfo(m),{xAxes:b,xAxesHidden:D}={xAxes:svgEl("g",{},"x-axes"),xAxesHidden:svgEl("g",{},"x-axes","hidden")},{yAxesGroupShown:S,yAxesGroupHidden:k}=function(){let e=svgEl("g",{},"y-axes"),t=svgEl("g",{},"y-axes","hidden");return[e,t].forEach(e=>{for(let t=0;t<u;t++)add(e,ue("",5,0))}),{yAxesGroupShown:e,yAxesGroupHidden:t}}(),B=ce(0,0,0,l),T=el("div","charts");add(T,x,v,y,E),add(v,B,function(){let e=svgEl("g"),t=Math.ceil(l/u);for(let a=0;a<u;a++){let i=ce(10,n-10,l-t*a,l-t*a);add(e,i)}return e}(),S,k,b,D),add(e,T,C);let L=0,F=h.length,P=-1,N=0,G=0,I=0,O=0,H=m.columns,$=Q(),V=Z(h,n),{max:R,min:X}=J(H),{max:_,min:z}=K(H),W=le(L,F),j=ie(W),q=null;function U(e,t,n,a){if(t===e&&n===a)return;let i=Math.ceil((t-a)/u),r=Array.apply(null,Array(u)).map((e,t)=>a+t*i),o=ee(r,t,l,0,a),s=k.childNodes;o.reverse().forEach((e,t)=>{let n=s[t];n.textContent=formatAxisValue(r[r.length-t-1]),svgAttrs(n,{x:5,y:l-e-5})}),removeClass(k,"m-down","m-up"),removeClass(S,"m-down","m-up"),addClass(k,t>e?"m-up":"m-down","pending"),addClass(S,t>e?"m-down":"m-up","pending");let d=k;k=S,S=d,setTimeout(()=>{removeClass(S,"hidden","pending"),removeClass(k,"pending"),addClass(k,"hidden")},0)}function Y(){if(-1===P||P<L||P>F)return B.style.display="none",E.style.display="none",void oe(m.columns,(e,t)=>{m.lines[t].chartPoint.style.animationName="exit"});let e=h[P],t=n*(e-h[L])/(h[F]-h[L]);svgAttrs(B,{x1:t,x2:t}),oe(m.columns,(e,n)=>{let a=ee([e[P]],G,l,c,N)[0],i=m.lines[n].chartPoint;i.style.animationName=w[n]?"enter":"exit",svgAttrs(i,{cx:t});let r=i.firstChild;svgAttrs(r,{from:r.getAttribute("to"),to:a}),r.beginElement(),A[n].value.innerText=formatPointValue(e[P]),A[n].value.parentElement.style.display=w[n]?"flex":"none"}),M.innerText=new Date(e).toString().slice(0,15);let a=t>n/2;E.style.transform="translateX("+(a?t-200:t+20)+"px)",E.style.display="block",B.style.display="block"}function K(e){let t=e.reduce((e,t)=>e.concat(t.data),[]);return{max:se(t),min:de(t)}}function J(e){let t=e.reduce((e,t)=>e.concat(t.data.slice(L,F+1)),[]);return{max:se(t),min:de(t)}}function Q(){return Z(h.slice(L,F+1),n)}function Z(e,t){let n=e[0],l=e[e.length-1],a=Math.abs(l-n);return e.map(e=>t*(e-n)/a)}function ee(e,t,n,l=0,a=0){let i=e.slice(0);for(let r=0;r<e.length;r++)i[r]=t?n*(i[r]-a)/(t-a)+l:l;return i}function te(e,t,n,l=1){drawLine(x,t,n,e.color,l,r)}function ne(e,t,n,l=1){drawLine(p,t,n,e.color,l,o)}function le(e,t){let n=Math.round(10*(t-e)/h.length);return Math.round(Math.log2(n))}function ae(e){return Math.ceil(g*Math.pow(2,e))}function ie(e){let t=[],n=ae(e);for(let e=0;e<h.length;e+=n)t.push(re(h[e]));return t}function re(e){let t=new Date(e).toString().slice(4,10);return"0"===t[4]?`${t.slice(0,4)}${t[5]}`:t}function oe(e,t){e.forEach(e=>t(e.data,e.name))}function se(e){return Math.max(...e)}function de(e){return Math.min(...e)}function ce(e,t,n,l){return svgEl("line",{x1:e,y1:n,x2:t,y2:l,fill:"gray",stroke:"gray","stroke-width":.3})}function ue(e,t,n){let l=svgEl("text",{x:t,y:n,"font-size":13});return l.textContent=e,l}oe(H,(e,t)=>{let n=m.colors[t],l=svgEl("circle",{r:6,fill:"white",stroke:n,"stroke-width":r});l.style.animationName="exit",m.lines[t]={chartPoint:l,color:n},add(l,function(e="points"){return svgEl("animate",{attributeName:e,repeatCount:1,dur:"250ms",fill:"freeze",from:0,to:0})}("cy")),add(v,l)}),oe(H,(e,t)=>{!function(e,t,n){let l=ee(t,_,i,0,z);ne(e,V,l,n)}(m.lines[t],e)}),O=_,I=z,on(e,"visibility-updated",({detail:e})=>{w=e;let t=m.columns.filter(e=>w[e.name]),{max:n,min:a}=J(t),{max:r,min:o}=K(t);!function(e,t,n,a,i,r){let o=n-a,d=i-r,c=e.length>=H.length?e:t;scheduleAnimation(e=>{clearCanvas(x),oe(c,(n,i)=>{let s=m.lines[i],c=1;t.find(e=>e.name===i)?w[i]||(c=Math.max(0,1-2*e)):c=Math.min(1,2*e);let u=n.slice(L,F+1),f=ee(u,a+o*e,l,0,r+d*e);te(s,$,f,c)})},s)}(t,H,n,G,a,N),function(e,t,n,l,a,r){let o=n-l,d=a-r,c=e.length>=H.length?e:t;scheduleAnimation(e=>{clearCanvas(p),oe(c,(n,a)=>{let s=m.lines[a],c=1;t.find(e=>e.name===a)?w[a]||(c=Math.max(0,1-2*e)):c=Math.min(1,2*e);let u=ee(n,l+o*e,i,0,r+d*e);ne(s,V,u,c)})},s)}(t,H,r,O,o,I),U(G,n,N,a),G=n,N=a,O=r,I=o,H=t,Y()}),on(e,"border-changed",({detail:{start:e,end:t}})=>{let a=le(e,t);a!==W&&(j=ie(a),function(e,t,n,l,a,i){let r=a!==i;if(n===l||!r){let n=b;b=D,D=n,addClass(b,"pending",r?"right":"",t>e?"even":""),removeClass(b,r?"":"right",t>e?"":"even"),addClass(D,r?"right":""),removeClass(D,"even",t>e?"pending":"",r?"":"right"),setTimeout(()=>{removeClass(b,"hidden"),addClass(D,"hidden")},0)}}(W,a,L,e,F,t),W=a),clearCanvas(x),L=e,F=t,$=Q();let i=J(H);if(X=i.min,R=i.max,oe(H,(e,t)=>{!function(e,t,n){let a=ee(t.slice(L,F+1),R,l,0,X);te(e,$,a,n)}(m.lines[t],e)}),!q){let e=G,t=N;q=setTimeout(()=>{U(e,R,t,X),q=null},s)}G=R,N=X,function(){clearChildren(b);let e=ae(W),t=1;for(;(L+t)%e!=0;)t++;if((L+t)%(2*e)!=0){let a=(L+t-e)/(2*e),i=n*(h[a]-h[L])/(h[F]-h[L]),r=ue(j[a],i,l+c-5);add(b,r)}for(let n=t;n<$.length-1;n+=e){let t=ue(j[(L+n)/e],$[n],l+c-5);add(b,t)}}(),Y()}),on(v,"click",e=>{let t=$[1]/2,n=L+Math.max(0,$.findIndex(n=>n+t>e.offsetX));n!==P&&(P=n,Y())}),on(d,"click",t=>{e.contains(t.target)||(P=-1,Y())})}function createPercentageStackedAreaChart(e,t){let n=Math.min(400,window.innerWidth),l=350,a=20,i=n-20,r=50,o=150,s=20,c=5,u=10*n/400,f=t.columns[0].slice(1),h={...t,columns:t.columns.slice(1).map(e=>({name:e[0],data:e.slice(1)})),lines:{}},m=Math.round(f.length/u/6),g=svgEl("svg",{viewBox:`0 0 ${n} ${l+s}`}),v=createCanvas(n,l),{preview:x,previewContainer:p}=function(){let t=el("div","preview-container"),n=createCanvas(i,r);return add(t,n,createSlider(f,e)),{previewContainer:t,preview:n}}(),{buttons:y,visibilityMap:C}=createButtons(h,e),{selectedPointInfo:w,pointChartValues:E,pointDate:A}=createSelectedPointInfo(h),{xAxes:M,xAxesHidden:b}={xAxes:svgEl("g",{},"x-axes"),xAxesHidden:svgEl("g",{},"x-axes","hidden")},{yAxesGroupShown:D,yAxesGroupHidden:S}=function(){let e=svgEl("g",{},"y-axes","m-up");e.style.opacity="0";for(let t=0;t<c;t++){let t=Q("",5,0);add(e,t)}return{yAxesGroupHidden:e}}(),k=J(0,0,0,l),B=el("div","charts");add(B,v,g,p,w),add(g,k,function(){let e=svgEl("g"),t=Math.ceil((l-a)/(c-1));for(let a=0;a<c;a++){let i=l-t*a,r=J(10,n-10,i,i);add(e,r)}return e}(),D,S,M,b),add(e,B,y);let T=0,L=f.length,F=-1,P=h.columns,N=_(),G=z(f,n),I=j(T,L),O=U(I);K(P,(e,t)=>{let n=h.colors[t];h.lines[t]={color:n}});let H=V(P);function $(){if(-1===F||F<T||F>L)return k.style.display="none",void(w.style.display="none");let e=f[F],t=n*(e-f[T])/(f[L]-f[T]);svgAttrs(k,{x1:t,x2:t});let l=h.columns.reduce((e,t)=>e+(C[t.name]?t.data[F]:0),0);K(h.columns,(e,t)=>{E[t].subValue.innerText=Math.round(e[F]/l*100)+"%",E[t].value.innerText=formatPointValue(e[F]),E[t].value.parentElement.style.display=C[t]?"flex":"none"}),A.innerText=new Date(e).toString().slice(0,15);let a=t>n/2;w.style.transform="translateX("+(a?t-200:t+20)+"px)",w.style.display="block",k.style.display="block"}function V(e){let t=e.reduce((e,t)=>(e[t.name]=[],e),{});for(let n=0;n<f.length;n++){let l=e.reduce((e,t)=>e+t.data[n],0);for(let a=0;a<e.length;a++){let i=e[a],r=e[a-1],o=e[a+1],s=r?t[r.name][2*n+1]:0,d=o?s+i.data[n]/l:1;t[i.name].push(s),t[i.name].push(d)}}return t}function R(e,t){let n=W(t,1,r);!function(e,t,n){drawStackedArea(x,t,n,e.color)}(e,G,n)}function X(e,t){let n=W(t.slice(2*T,2*L+2),1,l-a);drawStackedArea(v,N,n,e.color)}function _(){return z(f.slice(T,L+1),n)}function z(e,t){let n=e[0],l=e[e.length-1],a=Math.abs(l-n);return e.map(e=>t*(e-n)/a)}function W(e,t,n,l=0,a=0){let i=e.slice(0);for(let r=0;r<e.length;r++)i[r]=t?n*(i[r]-a)/(t-a)+l:l;return i}function j(e,t){let n=Math.round(10*(t-e)/f.length);return Math.round(Math.log2(n))}function q(e){return Math.ceil(m*Math.pow(2,e))}function U(e){let t=[],n=q(e);for(let e=0;e<f.length;e+=n)t.push(Y(f[e]));return t}function Y(e){let t=new Date(e).toString().slice(4,10);return"0"===t[4]?`${t.slice(0,4)}${t[5]}`:t}function K(e,t){e.forEach(e=>t(e.data,e.name))}function J(e,t,n,l){return svgEl("line",{x1:e,y1:n,x2:t,y2:l,fill:"gray",stroke:"gray","stroke-width":.3})}function Q(e,t,n){let l=svgEl("text",{x:t,y:n,"font-size":13});return l.textContent=e,l}!function(e){K(P,(t,n)=>{R(h.lines[n],e[n])})}(H),function(){let e=Math.ceil(100/(c-1)),t=Array.apply(null,Array(c)).map((t,n)=>n*e),n=W(t,100,l-a).reverse(),i=S.childNodes;n.forEach((e,n)=>{let a=i[n];a.textContent=formatAxisValue(t[t.length-n-1]),svgAttrs(a,{x:5,y:l-e-5})}),S.style.transition="0s",addClass(S,"m-up");let r=S;S=D,D=r,setTimeout(()=>{D.style.transition=null,D.style.opacity=null},0)}(),on(e,"visibility-updated",({detail:e})=>{C=e;let t=h.columns.filter(e=>C[e.name]),n=V(t);!function(e,t,n,l){let a={},i=e.concat(t).filter(e=>{let t=a[e.name];return a[e.name]=!0,!t}).sort((e,t)=>e.name>t.name?1:e.name===t.name?0:-1);scheduleAnimation(e=>{clearCanvas(v),clearCanvas(x);for(let a=0;a<i.length;a++){let r=i[a].name,o=h.lines[r],s=!t.find(e=>e.name===r),d=!C[r],c=i[a-1],u=i[a+1],f=[];if(s){let t=c?n[c.name]:null,a=c?l[c.name]:null,i=u?n[u.name]:null,o=u?l[u.name]:null;f=n[r].slice(0);for(let n=0;n<f.length-1;n+=2)f[n]=t?a[n+1]+(t[n+1]-a[n+1])*e:a?a[n+1]*(1-e):0,f[n+1]=i?o[n]+(i[n]-o[n])*e:a&&!t?1:t?1:e}else if(d){let t=c?n[c.name]:null,a=c?l[c.name]:null,i=u?n[u.name]:null,o=u?l[u.name]:null;f=l[r].slice(0);for(let n=0;n<f.length-1;n+=2)f[n]=a&&t?a[n+1]+(t[n+1]-a[n+1])*e:t?t[n+1]*e:i?f[n]*(1-e):f[n]+(1-f[n])*e,f[n+1]=o&&i?o[n]+(i[n]-(o[n]||1))*e:i?1-e:1}else{f=n[r].slice(0);let t=l[r];for(let n=0;n<f.length-1;n+=2)f[n]=t[n]+(f[n]-t[n])*e,f[n+1]=t[n+1]+(f[n+1]-t[n+1])*e}X(o,f),R(o,f)}},o)}(t,P,n,H),H=n,P=t,$()}),on(e,"border-changed",({detail:{start:e,end:t}})=>{let a=j(e,t);a!==I&&(O=U(a),function(e,t,n,l,a,i){let r=a!==i;if(n===l||!r){let n=M;M=b,b=n,addClass(M,"pending",r?"right":"",t>e?"even":""),removeClass(M,r?"":"right",t>e?"":"even"),addClass(b,r?"right":""),removeClass(b,"even",t>e?"pending":"",r?"":"right"),setTimeout(()=>{removeClass(M,"hidden"),addClass(b,"hidden")},0)}}(I,a,T,e,L,t),I=a),clearCanvas(v),T=e,L=t,N=_(),function(e){K(P,(t,n)=>{X(h.lines[n],e[n])})}(H),function(){clearChildren(M);let e=q(I),t=1;for(;(T+t)%e!=0;)t++;if((T+t)%(2*e)!=0){let a=(T+t-e)/(2*e),i=n*(f[a]-f[T])/(f[L]-f[T]),r=Q(O[a],i,l+s-5);add(M,r)}for(let n=t;n<N.length-1;n+=e){let t=Q(O[(T+n)/e],N[n],l+s-5);add(M,t)}}(),$()}),on(g,"click",e=>{let t=N[1]/2,n=T+Math.max(0,N.findIndex(n=>n+t>e.offsetX));n!==F&&(F=n,$())}),on(d,"click",t=>{e.contains(t.target)||(F=-1,$())})}function scheduleAnimation(e,t){let n=performance.now();requestAnimationFrame(function l(a){let i=Math.min(1,Math.max(0,a-n)/t);i<1&&requestAnimationFrame(l),e(i)})}function createCanvas(e,t){let n=el("canvas");return n.width=e,n.height=t,n.getContext("2d").setTransform(1,0,0,-1,0,t),n}function clearCanvas(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}function drawLine(e,t,n,l,a=1,i=1){let r=e.getContext("2d");r.beginPath(),r.globalAlpha=a,r.strokeStyle=l,r.lineWidth=i,r.moveTo(Math.round(t[0]),Math.round(n[0]));for(let e=1;e<t.length;e++)r.lineTo(Math.round(t[e]),Math.round(n[e]));r.stroke()}function drawBars(e,t,n,l,a){let i=e.getContext("2d");i.beginPath(),i.fillStyle=l;for(let e=0;e<t.length;e++)i.rect(t[e],0,Math.ceil(a),Math.round(n[e]));i.fill()}function drawStackedArea(e,t,n,l){let a=e.getContext("2d");a.beginPath(),a.fillStyle=l,a.strokeStyle=l,a.lineWidth=1,a.moveTo(Math.round(t[0]),Math.floor(n[0]));for(let e=1;e<t.length;e++)a.lineTo(Math.round(t[e]),Math.floor(n[2*e]));for(let e=t.length-1;e>=0;e--)a.lineTo(Math.round(t[e]),Math.ceil(n[2*e+1]));a.fill()}function drawStackedBars(e,t,n,l,a,i=1){let r=e.getContext("2d");r.beginPath(),a=Math.ceil(a),r.fillStyle=l,r.globalAlpha=i;for(let e=0;e<t.length;e++)r.rect(t[e],n[2*e],a,n[2*e+1]);r.fill()}function createSelectedPointInfo(e){let n=el("div","point-info"),l=el("div","charts-info"),a=el("div");return add(n,a,l),{selectedPointInfo:n,pointChartValues:Object.entries(e.names).reduce((n,[a,i])=>{let r=el("div","info"),o=el("span"),s=el("span");o.style.color=TOOLTIP_COLORS[e.colors[a]],n[a]={value:o,subValue:s};let d=el("span","name");return add(d,t(i)),add(r,s,d,o),add(l,r),n},{}),pointDate:a}}const BUTTON_COLORS={"#FE3C30":"#E65850","#4BD964":"#5FB641","#108BE3":"#3497ED","#E8AF14":"#F5BD25","#3497ED":"#3497ED","#2373DB":"#3381E8","#9ED448":"#9ED448","#5FB641":"#5FB641","#F5BD25":"#F5BD25","#F79E39":"#F79E39","#E65850":"#E65850"},TOOLTIP_COLORS={"#FE3C30":"#F34C44","#4BD964":"#3CC23F","#108BE3":"#108BE3","#E8AF14":"#E4AE1B","#64ADED":"#3896E8","#3497ED":"#108BE3","#2373DB":"#2373DB","#9ED448":"#89C32E","#5FB641":"#4BAB29","#F5BD25":"#EAAF10","#F79E39":"#F58608","#E65850":"#F34C44"},LINE_COLORS={"#3497ED":"#3497ED","#2373DB":"#2373DB","#9ED448":"#9ED448","#5FB641":"#5FB641","#F5BD25":"#F5BD25","#F79E39":"#F79E39","#E65850":"#E65850"};function getLineColor(e){return LINE_COLORS[e]}function isTouchDevice(){return"ontouchstart"in d.documentElement}let d=document;function el(e,...t){return addClass(d.createElement(e),...t)}function t(e){return d.createTextNode(e)}function svgEl(e,t,...n){let l=d.createElementNS("http://www.w3.org/2000/svg",e);return svgAttrs(l,t),addClass(l,...n)}function svgAttrs(e,t={}){Object.entries(t).forEach(([t,n])=>{e.setAttributeNS(null,t,n)})}function addClass(e,...t){return e.classList.add(...t.filter(e=>e)),e}function removeClass(e,...t){e.classList.remove(...t.filter(e=>e))}function add(e,...t){t.filter(e=>!!e).forEach(t=>e.appendChild(t))}function on(e,t,n){e.addEventListener(t,n)}function off(e,t,n){e.removeEventListener(t,n)}function emit(e,t,n){e.dispatchEvent(new CustomEvent(t,{detail:n}))}function applyAnimation(e,t,n=250){e.style.animationName=t,setTimeout(()=>{e.style.animationName=null},n)}function clearChildren(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function formatAxisValue(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e}function formatPointValue(e){let t="",n=e.toString();for(let e=0;e<n.length/3;e++)t=n.slice(Math.max(0,n.length-3*e-3),n.length-3*e)+" "+t;return t}function createButtons(e,n){let l=300,a=null,i=el("div","buttons");on(i,isTouchDevice()?"touchstart":"mousedown",function(e){let t=e.target.dataset.chart;if(!t)return;on(i,isTouchDevice()?"touchend":"mouseup",o),a=setTimeout(()=>{!function(e){a=null,r={[e]:!0},[...i.childNodes].forEach(e=>r[e.dataset.chart]?removeClass(e,"m-hidden"):addClass(e,"m-hidden")),emit(n,"visibility-updated",r)}(t)},l)});let r=Object.keys(e.names).reduce((e,t)=>({...e,[t]:!0}),{});function o(e){off(i,isTouchDevice()?"touchend":"mouseup",o),a&&(clearTimeout(a),a=null,function(e){let t=e.target,l=t.dataset.chart;if(!l)return;let a={...r,[l]:!r[l]};if(!Object.values(a).some(e=>e))return void applyAnimation(t,"shake",800);e.target.classList.toggle("m-hidden"),emit(n,"visibility-updated",r=a)}(e))}return Object.keys(e.names).forEach(n=>{let l=el("button"),a=el("div");add(l,a);const r=BUTTON_COLORS[e.colors[n]];l.style.borderColor=r,a.style.background=r;let o=svgEl("svg",{width:"18",height:"18",viewBox:"0 0 24 24"});add(o,svgEl("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}));let s=el("span");s.style.color=r,add(s,t(e.names[n])),add(l,o,s),l.dataset.chart=n,add(i,l)}),{buttons:i,visibilityMap:r}}function createChart(e,n){let l=d.getElementById("charts-container"),a=el("div","chart-wrapper"),i=el("div","chart-info"),r=el("h1"),o=el("div","selected-range"),s=el("div","range-from"),c=el("span","range-to");add(o,s,t(" - "),c),add(r,t("Chart #"+n)),add(i,r,o),add(a,i),e.y_scaled?createDoubleYLineChart(a,e):"bar"!==e.types.y0||e.stacked?"area"===e.types.y0?createPercentageStackedAreaChart(a,e):"bar"===e.types.y0&&e.stacked?createBarStackedChart(a,e):createLineChart(a,e):createBarChart(a,e),add(l,a);let u=null,f=e.columns[0].slice(1),h=-1,m=-1,g=-1,v=-1;on(a,"border-changed",({detail:{start:e,end:t}})=>{g=e,v=t,u||(u=setTimeout(()=>{u=null,g!==h&&(h=g,s.textContent=p(f[h]),applyAnimation(s,"time-change")),v!==m&&(m=v,c.textContent=p(f[m]),applyAnimation(c,"time-change"))},250))});let x=new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"long",year:"numeric"});function p(e){return x.format(new Date(e))}}let isDark=!1;function createSlider(e,t){let n,l=50,{slider:a,leftBar:i,rightBar:r}=function(){let e=el("div","slider"),t=el("div","slider__bar","left"),n=el("div","slider__bar","right");return{slider:e,leftBar:t,rightBar:n}}(),o=el("div","shadow","left"),s=el("div","shadow","right");on(t,"mousedown",v),on(t,"touchstart",v);let c,u,f,h=0,m=0,g={start:-1,end:-1};function v(e){let n=e.target,l=n===a?x:n===i||n===r?e=>(function(e,t){e.preventDefault();let n=y(e),l=f-n,a=t?Math.max(0,c-l):u,i=t?m:Math.max(0,h+l);C(a,i)&&(t?w(a):E(i),M())})(e,n===i):void 0;if(!l)return;f=y(e);let o=()=>{p(),off(t,"mousemove",l),off(t,"touchmove",l),off(d,"mouseup",o),off(d,"touchend",o)};on(t,"mousemove",l),on(t,"touchmove",l),on(d,"mouseup",o),on(d,"touchend",o)}function x(e){e.preventDefault();let t=y(e),n=f-t,l=c-n,a=h+n;C(l,a)&&(w(l),E(a),M())}function p(){C(u,m)&&(c=u,h=m)}function y(e){return e.touches?e.touches[0].clientX:e.clientX}function C(e,t){return e>=0&&t>=0&&n-e-t>=l}function w(e){u=e,A(o,e)}function E(e){m=e,A(s,e)}function A(e,t){e.style.width=`${t}px`}function M(){let l={start:Math.max(0,Math.round(u*e.length/n)),end:Math.min(e.length-1,Math.round((n-m)*(e.length-1)/n))};g.start===l.start&&g.end===l.end||(g=l,emit(t,"border-changed",l))}requestAnimationFrame(()=>{n=a.parentElement.getBoundingClientRect().width,u=n-l,E(m),w(u),p(),M()});let b=el("div","slider-container");return add(b,o,i,a,r,s),b}(()=>{let e="Switch to Night Mode",t="Switch to Day Mode",n=d.getElementById("mode-switcher");on(n,"click",function(){d.body.classList.toggle("dark"),isDark=!isDark,n.innerText=isDark?t:e}),n.innerText=e})();