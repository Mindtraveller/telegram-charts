function scheduleAnimation(e,t){let n=performance.now();requestAnimationFrame(function i(l){let o=Math.min(1,Math.max(0,l-n)/t);o<1&&requestAnimationFrame(i),e(o)})}function createCanvas(e,t){let n=el("canvas");return n.width=e,n.height=t,n.getContext("2d").setTransform(1,0,0,-1,0,t),n}function clearCanvas(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}function drawLine(e,t,n,i,l=1,o=1){let a=e.getContext("2d");a.beginPath(),a.globalAlpha=l,a.strokeStyle=i,a.lineWidth=o,a.moveTo(t[0],n[0]);for(let e=1;e<t.length;e++)a.lineTo(t[e],n[e]);a.stroke()}function isTouchDevice(){return"ontouchstart"in d.documentElement}let d=document;function el(e,...t){return addClass(d.createElement(e),...t)}function t(e){return d.createTextNode(e)}function svgEl(e,t,...n){let i=d.createElementNS("http://www.w3.org/2000/svg",e);return svgAttrs(i,t),addClass(i,...n)}function svgAttrs(e,t={}){Object.entries(t).forEach(([t,n])=>{e.setAttributeNS(null,t,n)})}function addClass(e,...t){return e.classList.add(...t.filter(e=>e)),e}function removeClass(e,...t){e.classList.remove(...t.filter(e=>e))}function add(e,...t){t.forEach(t=>e.appendChild(t))}function on(e,t,n){e.addEventListener(t,n)}function off(e,t,n){e.removeEventListener(t,n)}function emit(e,t,n){e.dispatchEvent(new CustomEvent(t,{detail:n}))}function createButtons(e,n){let i=300,l=null,o=el("div","buttons");on(o,isTouchDevice()?"touchstart":"mousedown",function(e){let t=e.target.dataset.chart;if(!t)return;on(o,isTouchDevice()?"touchend":"mouseup",r),l=setTimeout(()=>{!function(e){l=null,a={[e]:!0},[...o.childNodes].forEach(e=>a[e.dataset.chart]?removeClass(e,"m-hidden"):addClass(e,"m-hidden")),emit(n,"visibility-updated",a)}(t)},i)});let a=Object.keys(e.names).reduce((e,t)=>({...e,[t]:!0}),{});function r(e){off(o,isTouchDevice()?"touchend":"mouseup",r),l&&(clearTimeout(l),l=null,function(e){let t=e.target,i=t.dataset.chart;if(!i)return;let l={...a,[i]:!a[i]};if(!Object.values(l).some(e=>e))return t.style.animationName=null,t.offsetWidth,void(t.style.animationName="shake");e.target.classList.toggle("m-hidden"),emit(n,"visibility-updated",a=l)}(e))}return Object.keys(e.names).forEach(n=>{let i=el("button"),l=el("div");add(i,l),i.style.borderColor=e.colors[n],l.style.background=e.colors[n];let a=svgEl("svg",{width:"18",height:"18",viewBox:"0 0 24 24"});add(a,svgEl("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}));let r=el("span");r.style.color=e.colors[n],add(r,t(e.names[n])),add(i,a,r),i.dataset.chart=n,add(o,i)}),{buttons:o,visibilityMap:a}}function createChart(e){let n=d.getElementById("charts-container"),i=Math.min(500,window.innerWidth),l=400,o=i-20,a=50,r=2,s=1,c=250,u=20,f=5,h=.95,m=10*i/500,v=e.columns[0].slice(1),g={...e,columns:e.columns.slice(1).map(e=>({name:e[0],data:e.slice(1)})),lines:{}},p=Math.round(v.length/m/6),x=el("div","chart-wrapper"),y=svgEl("svg",{viewBox:`0 0 ${i} ${l+u}`}),C=createCanvas(i,l),{preview:w,previewContainer:E}=function(){let e=el("div","preview-container"),t=createCanvas(o,a);return add(e,t,createSlider(v,x)),{previewContainer:e,preview:t}}(),{buttons:b,visibilityMap:M}=createButtons(g,x),{selectedPointInfo:A,pointChartValues:T,pointDate:k}=function(){let e=el("div","point-info"),n=el("div","charts-info"),i=el("div");add(e,i,n);let l=Object.entries(g.names).reduce((e,[i,l])=>{let o=el("div","info");o.style.color=g.colors[i];let a=el("span");return e[i]=a,add(o,a,t(l)),add(n,o),e},{});return{selectedPointInfo:e,pointChartValues:l,pointDate:i}}(),{xAxes:L,xAxesHidden:N}={xAxes:svgEl("g",{},"x-axes"),xAxesHidden:svgEl("g",{},"x-axes","hidden")},{yAxesGroupShown:B,yAxesGroupHidden:D}=function(){let e=svgEl("g",{},"y-axes"),t=svgEl("g",{},"y-axes","hidden");return[e,t].forEach(e=>{for(let t=0;t<f;t++)add(e,se(10,i-10,0,0),de("",5,0))}),{yAxesGroupShown:e,yAxesGroupHidden:t}}(),S=se(0,0,u,u+l);add(y,function(){let e=svgEl("g");return add(e,se(10,i-10,u,u),de("0",5,u+15)),e}(),S,B,D,L,N),add(x,C,y,E,b,A);let P=0,$=v.length,j=-1,I=0,O=0,G=g.columns,H=U(),_=Y(v,i),q=K(G),z=J(G),F=ne(P,$),W=le(F),X=null;function R(e,t){if(t===e)return;let n=Math.ceil(t*h/(f-1)),i=Array.apply(null,Array(f-1)).map((e,t)=>(t+1)*n),o=Z(i,re(i),l*h,u),a=D.childNodes;o.forEach((e,t)=>{svgAttrs(a[2*t],{y1:e,y2:e});let n=a[2*t+1];n.textContent=i[i.length-t-1],svgAttrs(n,{x:5,y:e-5})}),removeClass(D,"m-down","m-up"),removeClass(B,"m-down","m-up"),addClass(D,t>e?"m-up":"m-down","pending"),addClass(B,t>e?"m-down":"m-up","pending");let r=D;D=B,B=r,setTimeout(()=>{removeClass(B,"hidden","pending"),removeClass(D,"pending"),addClass(D,"hidden")},0)}function V(){if(-1===j||j<P||j>$)return S.style.display="none",A.style.display="none",void ae(g.columns,(e,t)=>{g.lines[t].chartPoint.style.animationName="exit"});let e=v[j],t=i*(e-v[P])/(v[$]-v[P]);svgAttrs(S,{x1:t,x2:t}),ae(g.columns,(e,n)=>{let i=Z([e[j]],I,l,u)[0],o=g.lines[n].chartPoint;o.style.animationName=M[n]?"enter":"exit",svgAttrs(o,{cx:t});let a=o.firstChild;svgAttrs(a,{from:a.getAttribute("to"),to:i}),a.beginElement(),T[n].innerText=e[j],T[n].parentElement.style.display=M[n]?"flex":"none"}),k.innerText=new Date(e).toString().slice(0,10);let n=t>i/2;A.style[n?"right":"left"]=`${n?i-t:t}px`,A.style[n?"left":"right"]=null,A.style.display="block",S.style.display="block"}function J(e){return re(e.reduce((e,t)=>e.concat(t.data),[]))}function K(e){return re(e.reduce((e,t)=>e.concat(t.data.slice(P,$+1)),[]))}function Q(e=!1){ae(G,(t,n)=>{!function(e,t,n){let i=Z(t.slice(P,$+1),q,l);ee(e,H,i,n)}(g.lines[n],t),e&&function(e,t,n){let i=Z(t,z,a);te(e,_,i,n)}(g.lines[n],t)})}function U(){return Y(v.slice(P,$+1),i)}function Y(e,t){let n=e[0],i=e[e.length-1],l=Math.abs(i-n);return e.map(e=>t*(e-n)/l)}function Z(e,t,n,i=0){return e.map(e=>t?n*e/t+i:i)}function ee(e,t,n,i=1){drawLine(C,t,n,e.color,i,r)}function te(e,t,n,i=1){drawLine(w,t,n,e.color,i,s)}function ne(e,t){let n=Math.round(10*(t-e)/v.length);return Math.round(Math.log2(n))}function ie(e){return Math.ceil(p*Math.pow(2,e))}function le(e){let t=[],n=ie(e);for(let e=0;e<v.length;e+=n)t.push(oe(v[e]));return t}function oe(e){let t=new Date(e).toString().slice(4,10);return"0"===t[4]?`${t.slice(0,4)}${t[5]}`:t}function ae(e,t){e.forEach(e=>t(e.data,e.name))}function re(e){return Math.max(...e)}function se(e,t,n,i){return svgEl("line",{x1:e,y1:n,x2:t,y2:i,fill:"gray",stroke:"gray","stroke-width":.3})}function de(e,t,n){let i=svgEl("text",{x:t,y:n,"font-size":13});return i.textContent=e,i}ae(G,(e,t)=>{let n=g.colors[t],i=svgEl("circle",{r:6,fill:"white",stroke:n,"stroke-width":r});i.style.animationName="exit",g.lines[t]={chartPoint:i,color:n},add(i,function(e="points"){return svgEl("animate",{attributeName:e,repeatCount:1,dur:"250ms",fill:"freeze",from:0,to:0})}("cy")),add(y,i)}),add(n,x),Q(!0),R(I,q),I=q,O=z,on(x,"visibility-updated",({detail:e})=>{M=e;let t=g.columns.filter(e=>M[e.name]);q=K(t),z=J(t),function(e,t,n,i,o,r){let s=n-i,d=o-r,u=e.length>=G.length?e:t;scheduleAnimation(e=>{clearCanvas(C),clearCanvas(w),ae(u,(n,o)=>{let c=g.lines[o],u=1;t.find(e=>e.name===o)?M[o]||(u=Math.max(0,1-2*e)):u=Math.min(1,2*e);let f=n.slice(P,$+1),h=Z(f,i+s*e,l);ee(c,H,h,u);let m=Z(n,r+d*e,a);te(c,_,m,u)})},c)}(t,G,q,I,z,O),R(I,q),I=q,O=z,G=t,V()}),on(x,"border-changed",({detail:{start:e,end:t}})=>{let n=ne(e,t);if(n!==F&&(W=le(n),function(e,t,n,i,l,o){let a=l!==o;if(n===i||!a){let n=L;L=N,N=n,addClass(L,"pending",a?"right":"",t>e?"even":""),removeClass(L,a?"":"right",t>e?"":"even"),addClass(N,a?"right":""),removeClass(N,"even",t>e?"pending":"",a?"":"right"),setTimeout(()=>{removeClass(L,"hidden"),addClass(N,"hidden")},0)}}(F,n,P,e,$,t),F=n),clearCanvas(C),P=e,$=t,H=U(),q=K(G),Q(),!X){let e=I;X=setTimeout(()=>{R(e,q),X=null},100)}I=q,function(){!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(L);let e=ie(F),t=1;for(;(P+t)%e!=0;)t++;if((P+t)%(2*e)!=0){let n=(P+t-e)/(2*e),l=i*(v[n]-v[P])/(v[$]-v[P]),o=de(W[n],l,-2);add(L,o)}for(let n=t;n<H.length-1;n+=e){let t=de(W[(P+n)/e],H[n],-2);add(L,t)}}(),V()}),on(y,"click",e=>{let t=H[1]/2,n=P+Math.max(0,H.findIndex(n=>n+t>e.offsetX));n!==j&&(j=n,V())}),on(d,"click",e=>{x.contains(e.target)||(j=-1,V())})}function createSlider(e,t){let n,i=50,{slider:l,leftBar:o,rightBar:a}=function(){let e=el("div","slider"),t=el("div","slider__bar"),n=el("div","slider__bar","right");return add(e,t,n),{slider:e,leftBar:t,rightBar:n}}(),r=el("div","shadow","left"),s=el("div","shadow","right");on(t,"mousedown",g),on(t,"touchstart",g);let c,u,f,h=0,m=0,v={start:-1,end:-1};function g(e){let n=e.target,i=n===l?p:n===o||n===a?e=>(function(e,t){e.preventDefault();let n=y(e),i=f-n,l=t?Math.max(0,c-i):u,o=t?m:Math.max(0,h+i);C(l,o)&&(t?w(l):E(o),M())})(e,n===o):void 0;if(!i)return;f=y(e);let r=()=>{x(),off(t,"mousemove",i),off(t,"touchmove",i),off(d,"mouseup",r),off(d,"touchend",r)};on(t,"mousemove",i),on(t,"touchmove",i),on(d,"mouseup",r),on(d,"touchend",r)}function p(e){e.preventDefault();let t=y(e),n=f-t,i=c-n,l=h+n;C(i,l)&&(w(i),E(l),M())}function x(){C(u,m)&&(c=u,h=m)}function y(e){return e.touches?e.touches[0].clientX:e.clientX}function C(e,t){return e>=0&&t>=0&&n-e-t>=i}function w(e){u=e,b(r,e)}function E(e){m=e,b(s,e)}function b(e,t){e.style.width=`${t}px`}function M(){let i={start:Math.max(0,Math.round(u*e.length/n)),end:Math.min(e.length-1,Math.round((n-m)*(e.length-1)/n))};v.start===i.start&&v.end===i.end||(v=i,emit(t,"border-changed",i))}requestAnimationFrame(()=>{n=l.parentElement.getBoundingClientRect().width,u=n-i,E(m),w(u),x(),M()});let A=el("div","slider-container");return add(A,r,l,s),A}(()=>{let e="Switch to Night Mode",t="Switch to Day Mode",n=!1,i=d.getElementById("mode-switcher");on(i,"click",function(){d.body.classList.toggle("dark"),n=!n,i.innerText=n?t:e}),i.innerText=e})();