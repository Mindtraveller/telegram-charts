function createDoubleYLineChart(e,t){let n=Math.min(400,window.innerWidth),i=350,l=n-20,o=50,a=2,r=1,s=250,c=20,u=6,h=10*n/400,f=t.columns[0].slice(1),m={...t,columns:t.columns.slice(1).map(e=>({name:e[0],data:e.slice(1)})),lines:{}},g=Math.round(f.length/h/6),v=svgEl("svg",{viewBox:`0 0 ${n} ${i+c}`}),p=createCanvas(n,i),{preview:x,previewContainer:y}=function(){let t=el("div","preview-container"),n=createCanvas(l,o);return add(t,n,createSlider(f,e)),{previewContainer:t,preview:n}}(),{buttons:C,visibilityMap:w}=createButtons(m,e),{selectedPointInfo:E,pointChartValues:A,pointDate:M}=createSelectedPointInfo(m),{xAxes:b,xAxesHidden:T}={xAxes:svgEl("g",{},"x-axes"),xAxesHidden:svgEl("g",{},"x-axes","hidden")},{yAxesGroupShown:S,yAxesGroupHidden:k,yAxesRightGroupShown:L,yAxesRightGroupHidden:B}=function(){let e=svgEl("g",{},"y-axes"),n=svgEl("g",{},"y-axes","hidden");[e,n].forEach(e=>{for(let n=0;n<u;n++){let n=re("",5,0);svgAttrs(n,{fill:t.colors.y0}),add(e,n)}});let i=svgEl("g",{},"y-axes","m-right"),l=svgEl("g",{},"y-axes","m-right","hidden");return[i,l].forEach(e=>{for(let n=0;n<u;n++){let n=re("",5,0);svgAttrs(n,{fill:t.colors.y1}),add(e,n)}}),{yAxesGroupShown:e,yAxesGroupHidden:n,yAxesRightGroupShown:i,yAxesRightGroupHidden:l}}(),D=function(){let e=svgEl("g",{},"y-axes"),t=Math.ceil(i/u);for(let l=0;l<u;l++){let o=ae(10,n-10,i-t*l,i-t*l);add(e,o)}return e}(),N=ae(0,0,0,i),O=el("div","charts");add(O,p,v,y,E),add(v,N,D,S,k,L,B,b,T),add(e,O,C);let P=0,G=f.length,I=-1,F=0,H=m.columns,R=Y(),$=J(f,n),_=V(H);H.forEach(e=>e.yMax=oe(e.data));let X=ee(P,G),j=ne(X),z=null;function W(e,t,l){le(m.columns,(o,a)=>{let r="y1"===a,s=r?B:k,d=r?L:S;if(!w[a])return void addClass(d,"hidden","m-down");if(t[a]===e[a]&&l[a]&&w[a])return;let c=Math.ceil(t[a]/u),h=Array.apply(null,Array(u)).map((e,t)=>t*c),f=K(h,t[a],i).reverse(),m=k.childNodes,g=B.childNodes;if(f.forEach((e,t)=>{let l=r?g[t]:m[t];l.textContent=h[h.length-t-1],svgAttrs(l,{x:r?n-7*(l.textContent.length+1):5,y:i-e-5})}),removeClass(s,"m-down","m-up"),removeClass(d,"m-down","m-up"),addClass(s,t[a]>e[a]?"m-up":"m-down","pending"),addClass(d,t[a]>e[a]?"m-down":"m-up","pending"),r){let e=B;B=L,L=e}else{k=S,S=s}setTimeout(()=>{removeClass(s,"hidden","pending"),removeClass(d,"pending"),addClass(d,"hidden")},0)})}function q(){if(-1===I||I<P||I>G)return N.style.display="none",E.style.display="none",void le(m.columns,(e,t)=>{m.lines[t].chartPoint.style.animationName="exit"});let e=f[I],t=n*(e-f[P])/(f[G]-f[P]);svgAttrs(N,{x1:t,x2:t}),le(m.columns,(e,n)=>{let l=K([e[I]],F[n],i,c)[0],o=m.lines[n].chartPoint;o.style.animationName=w[n]?"enter":"exit",svgAttrs(o,{cx:t});let a=o.firstChild;svgAttrs(a,{from:a.getAttribute("to"),to:l}),a.beginElement(),A[n].innerText=e[I],A[n].parentElement.style.display=w[n]?"flex":"none"}),M.innerText=new Date(e).toString().slice(0,15);let l=t>n/2;E.style.transform="translateX("+(l?t-180:t)+"px)",E.style.display="block",N.style.display="block"}function V(e){return e.reduce((e,t)=>(e[t.name]=oe(t.data.slice(P,G+1)),e),{})}function U(e=!1){le(H,(t,n,l)=>{!function(e,t,n,l){let o=K(t.slice(P,G+1),n,i);Q(e,R,o,l)}(m.lines[n],t,_[n]),e&&function(e,t,n,i){let l=K(t,n,o);Z(e,$,l,i)}(m.lines[n],t,l.yMax)})}function Y(){return J(f.slice(P,G+1),n)}function J(e,t){let n=e[0],i=e[e.length-1],l=Math.abs(i-n);return e.map(e=>t*(e-n)/l)}function K(e,t,n,i=0){return e.map(e=>t?n*e/t+i:i)}function Q(e,t,n,i=1){drawLine(p,t,n,e.color,i,a)}function Z(e,t,n,i=1){drawLine(x,t,n,e.color,i,r)}function ee(e,t){let n=Math.round(10*(t-e)/f.length);return Math.round(Math.log2(n))}function te(e){return Math.ceil(g*Math.pow(2,e))}function ne(e){let t=[],n=te(e);for(let e=0;e<f.length;e+=n)t.push(ie(f[e]));return t}function ie(e){let t=new Date(e).toString().slice(4,10);return"0"===t[4]?`${t.slice(0,4)}${t[5]}`:t}function le(e,t){e.forEach(e=>t(e.data,e.name,e))}function oe(e){return Math.max(...e)}function ae(e,t,n,i){return svgEl("line",{x1:e,y1:n,x2:t,y2:i,fill:"gray",stroke:"gray","stroke-width":.3})}function re(e,t,n){let i=svgEl("text",{x:t,y:n,"font-size":13});return i.textContent=e,i}le(H,(e,t)=>{let n=m.colors[t],i=svgEl("circle",{r:6,fill:"white",stroke:n,"stroke-width":a});i.style.animationName="exit",m.lines[t]={chartPoint:i,color:n},add(i,function(e="points"){return svgEl("animate",{attributeName:e,repeatCount:1,dur:"250ms",fill:"freeze",from:0,to:0})}("cy")),add(v,i)}),U(!0),W(F,_),F=_,on(e,"visibility-updated",({detail:e})=>{let t=w;w=e;let n=m.columns.filter(e=>w[e.name]);_=V(m.columns),function(e,t,n){let l=e.length>=H.length?e:t;scheduleAnimation(e=>{clearCanvas(p),clearCanvas(x),le(l,(l,a,r)=>{let s=m.lines[a],d=1,c=r.yMax,u=o,h=i,f=!t.find(e=>e.name===a),g=!w[a];f?(d=Math.min(1,2*e),u*=1-e+1,h*=1-e+1):g&&(d=Math.max(0,1-2*e),h+=h*e,u+=u*e);let v=l.slice(P,G+1),p=K(v,n[a],h);Q(s,R,p,d);let x=K(l,c,u);Z(s,$,x,d)})},s)}(n,H,F),W(F,_,t),F=_,H=n,q()}),on(e,"border-changed",({detail:{start:e,end:t}})=>{let l=ee(e,t);if(l!==X&&(j=ne(l),function(e,t,n,i,l,o){let a=l!==o;if(n===i||!a){let n=b;b=T,T=n,addClass(b,"pending",a?"right":"",t>e?"even":""),removeClass(b,a?"":"right",t>e?"":"even"),addClass(T,a?"right":""),removeClass(T,"even",t>e?"pending":"",a?"":"right"),setTimeout(()=>{removeClass(b,"hidden"),addClass(T,"hidden")},0)}}(X,l,P,e,G,t),X=l),clearCanvas(p),P=e,G=t,R=Y(),_=V(H),U(),!z){let e=F;z=setTimeout(()=>{W(e,_,w),z=null},s)}F=_,function(){!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(b);let e=te(X),t=1;for(;(P+t)%e!=0;)t++;if((P+t)%(2*e)!=0){let l=(P+t-e)/(2*e),o=n*(f[l]-f[P])/(f[G]-f[P]),a=re(j[l],o,i+c-5);add(b,a)}for(let n=t;n<R.length-1;n+=e){let t=re(j[(P+n)/e],R[n],i+c-5);add(b,t)}}(),q()}),on(v,"click",e=>{let t=R[1]/2,n=P+Math.max(0,R.findIndex(n=>n+t>e.offsetX));n!==I&&(I=n,q())}),on(d,"click",t=>{e.contains(t.target)||(I=-1,q())})}function createLineChart(e,t){let n=Math.min(400,window.innerWidth),i=350,l=n-20,o=50,a=2,r=1,s=250,c=20,u=6,h=10*n/400,f=t.columns[0].slice(1),m={...t,columns:t.columns.slice(1).map(e=>({name:e[0],data:e.slice(1)})),lines:{}},g=Math.round(f.length/h/6),v=svgEl("svg",{viewBox:`0 0 ${n} ${i+c}`}),p=createCanvas(n,i),{preview:x,previewContainer:y}=function(){let t=el("div","preview-container"),n=createCanvas(l,o);return add(t,n,createSlider(f,e)),{previewContainer:t,preview:n}}(),{buttons:C,visibilityMap:w}=createButtons(m,e),{selectedPointInfo:E,pointChartValues:A,pointDate:M}=createSelectedPointInfo(m),{xAxes:b,xAxesHidden:T}={xAxes:svgEl("g",{},"x-axes"),xAxesHidden:svgEl("g",{},"x-axes","hidden")},{yAxesGroupShown:S,yAxesGroupHidden:k}=function(){let e=svgEl("g",{},"y-axes"),t=svgEl("g",{},"y-axes","hidden");return[e,t].forEach(e=>{for(let t=0;t<u;t++)add(e,re("",5,0))}),{yAxesGroupShown:e,yAxesGroupHidden:t}}(),L=ae(0,0,0,i),B=el("div","charts");add(B,p,v,y,E),add(v,L,function(){let e=svgEl("g",{},"y-axes1"),t=Math.ceil(i/u);for(let l=0;l<u;l++){let o=ae(10,n-10,i-t*l,i-t*l);add(e,o)}return e}(),S,k,b,T),add(e,B,C);let D=0,N=f.length,O=-1,P=0,G=0,I=m.columns,F=Y(),H=J(f,n),R=V(I),$=q(I),_=ee(D,N),X=ne(_),j=null;function z(e,t){if(t===e)return;let n=Math.ceil(t/u),l=Array.apply(null,Array(u)).map((e,t)=>t*n),o=K(l,t,i),a=k.childNodes;o.reverse().forEach((e,t)=>{let n=a[t];n.textContent=l[l.length-t-1],svgAttrs(n,{x:5,y:i-e-5})}),removeClass(k,"m-down","m-up"),removeClass(S,"m-down","m-up"),addClass(k,t>e?"m-up":"m-down","pending"),addClass(S,t>e?"m-down":"m-up","pending");let r=k;k=S,S=r,setTimeout(()=>{removeClass(S,"hidden","pending"),removeClass(k,"pending"),addClass(k,"hidden")},0)}function W(){if(-1===O||O<D||O>N)return L.style.display="none",E.style.display="none",void le(m.columns,(e,t)=>{m.lines[t].chartPoint.style.animationName="exit"});let e=f[O],t=n*(e-f[D])/(f[N]-f[D]);svgAttrs(L,{x1:t,x2:t}),le(m.columns,(e,n)=>{let l=K([e[O]],P,i,c)[0],o=m.lines[n].chartPoint;o.style.animationName=w[n]?"enter":"exit",svgAttrs(o,{cx:t});let a=o.firstChild;svgAttrs(a,{from:a.getAttribute("to"),to:l}),a.beginElement(),A[n].innerText=e[O],A[n].parentElement.style.display=w[n]?"flex":"none"}),M.innerText=new Date(e).toString().slice(0,15);let l=t>n/2;E.style.transform="translateX("+(l?t-180:t)+"px)",E.style.display="block",L.style.display="block"}function q(e){return oe(e.reduce((e,t)=>e.concat(t.data),[]))}function V(e){return oe(e.reduce((e,t)=>e.concat(t.data.slice(D,N+1)),[]))}function U(e=!1){le(I,(t,n)=>{!function(e,t,n){let l=K(t.slice(D,N+1),R,i);Q(e,F,l,n)}(m.lines[n],t),e&&function(e,t,n){let i=K(t,$,o);Z(e,H,i,n)}(m.lines[n],t)})}function Y(){return J(f.slice(D,N+1),n)}function J(e,t){let n=e[0],i=e[e.length-1],l=Math.abs(i-n);return e.map(e=>t*(e-n)/l)}function K(e,t,n,i=0){return e.map(e=>t?n*e/t+i:i)}function Q(e,t,n,i=1){drawLine(p,t,n,e.color,i,a)}function Z(e,t,n,i=1){drawLine(x,t,n,e.color,i,r)}function ee(e,t){let n=Math.round(10*(t-e)/f.length);return Math.round(Math.log2(n))}function te(e){return Math.ceil(g*Math.pow(2,e))}function ne(e){let t=[],n=te(e);for(let e=0;e<f.length;e+=n)t.push(ie(f[e]));return t}function ie(e){let t=new Date(e).toString().slice(4,10);return"0"===t[4]?`${t.slice(0,4)}${t[5]}`:t}function le(e,t){e.forEach(e=>t(e.data,e.name))}function oe(e){return Math.max(...e)}function ae(e,t,n,i){return svgEl("line",{x1:e,y1:n,x2:t,y2:i,fill:"gray",stroke:"gray","stroke-width":.3})}function re(e,t,n){let i=svgEl("text",{x:t,y:n,"font-size":13});return i.textContent=e,i}le(I,(e,t)=>{let n=m.colors[t],i=svgEl("circle",{r:6,fill:"white",stroke:n,"stroke-width":a});i.style.animationName="exit",m.lines[t]={chartPoint:i,color:n},add(i,function(e="points"){return svgEl("animate",{attributeName:e,repeatCount:1,dur:"250ms",fill:"freeze",from:0,to:0})}("cy")),add(v,i)}),U(!0),z(P,R),P=R,G=$,on(e,"visibility-updated",({detail:e})=>{w=e;let t=m.columns.filter(e=>w[e.name]);R=V(t),$=q(t),function(e,t,n,l,a,r){let d=n-l,c=a-r,u=e.length>=I.length?e:t;scheduleAnimation(e=>{clearCanvas(p),clearCanvas(x),le(u,(n,a)=>{let s=m.lines[a],u=1;t.find(e=>e.name===a)?w[a]||(u=Math.max(0,1-2*e)):u=Math.min(1,2*e);let h=n.slice(D,N+1),f=K(h,l+d*e,i);Q(s,F,f,u);let g=K(n,r+c*e,o);Z(s,H,g,u)})},s)}(t,I,R,P,$,G),z(P,R),P=R,G=$,I=t,W()}),on(e,"border-changed",({detail:{start:e,end:t}})=>{let l=ee(e,t);if(l!==_&&(X=ne(l),function(e,t,n,i,l,o){let a=l!==o;if(n===i||!a){let n=b;b=T,T=n,addClass(b,"pending",a?"right":"",t>e?"even":""),removeClass(b,a?"":"right",t>e?"":"even"),addClass(T,a?"right":""),removeClass(T,"even",t>e?"pending":"",a?"":"right"),setTimeout(()=>{removeClass(b,"hidden"),addClass(T,"hidden")},0)}}(_,l,D,e,N,t),_=l),clearCanvas(p),D=e,N=t,F=Y(),R=V(I),U(),!j){let e=P;j=setTimeout(()=>{z(e,R),j=null},s)}P=R,function(){!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(b);let e=te(_),t=1;for(;(D+t)%e!=0;)t++;if((D+t)%(2*e)!=0){let l=(D+t-e)/(2*e),o=n*(f[l]-f[D])/(f[N]-f[D]),a=re(X[l],o,i+c-5);add(b,a)}for(let n=t;n<F.length-1;n+=e){let t=re(X[(D+n)/e],F[n],i+c-5);add(b,t)}}(),W()}),on(v,"click",e=>{let t=F[1]/2,n=D+Math.max(0,F.findIndex(n=>n+t>e.offsetX));n!==O&&(O=n,W())}),on(d,"click",t=>{e.contains(t.target)||(O=-1,W())})}function scheduleAnimation(e,t){let n=performance.now();requestAnimationFrame(function i(l){let o=Math.min(1,Math.max(0,l-n)/t);o<1&&requestAnimationFrame(i),e(o)})}function createCanvas(e,t){let n=el("canvas");return n.width=e,n.height=t,n.getContext("2d").setTransform(1,0,0,-1,0,t),n}function clearCanvas(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}function drawLine(e,t,n,i,l=1,o=1){let a=e.getContext("2d");a.beginPath(),a.globalAlpha=l,a.strokeStyle=i,a.lineWidth=o,a.moveTo(t[0],n[0]);for(let e=1;e<t.length;e++)a.lineTo(t[e],n[e]);a.stroke()}function createSelectedPointInfo(e){let n=el("div","point-info"),i=el("div","charts-info"),l=el("div");return add(n,l,i),{selectedPointInfo:n,pointChartValues:Object.entries(e.names).reduce((n,[l,o])=>{let a=el("div","info"),r=el("span");return r.style.color=TOOLTIP_COLORS[e.colors[l]],n[l]=r,add(a,t(o),r),add(i,a),n},{}),pointDate:l}}const BUTTON_COLORS={"#FE3C30":"#E65850","#4BD964":"#5FB641","#108BE3":"#3497ED","#E8AF14":"#F5BD25"},TOOLTIP_COLORS={"#FE3C30":"#F34C44","#4BD964":"#3CC23F","#108BE3":"#108BE3","#E8AF14":"#E4AE1B"};function isTouchDevice(){return"ontouchstart"in d.documentElement}let d=document;function el(e,...t){return addClass(d.createElement(e),...t)}function t(e){return d.createTextNode(e)}function svgEl(e,t,...n){let i=d.createElementNS("http://www.w3.org/2000/svg",e);return svgAttrs(i,t),addClass(i,...n)}function svgAttrs(e,t={}){Object.entries(t).forEach(([t,n])=>{e.setAttributeNS(null,t,n)})}function addClass(e,...t){return e.classList.add(...t.filter(e=>e)),e}function removeClass(e,...t){e.classList.remove(...t.filter(e=>e))}function add(e,...t){t.filter(e=>!!e).forEach(t=>e.appendChild(t))}function on(e,t,n){e.addEventListener(t,n)}function off(e,t,n){e.removeEventListener(t,n)}function emit(e,t,n){e.dispatchEvent(new CustomEvent(t,{detail:n}))}function createButtons(e,n){let i=300,l=null,o=el("div","buttons");on(o,isTouchDevice()?"touchstart":"mousedown",function(e){let t=e.target.dataset.chart;if(!t)return;on(o,isTouchDevice()?"touchend":"mouseup",r),l=setTimeout(()=>{!function(e){l=null,a={[e]:!0},[...o.childNodes].forEach(e=>a[e.dataset.chart]?removeClass(e,"m-hidden"):addClass(e,"m-hidden")),emit(n,"visibility-updated",a)}(t)},i)});let a=Object.keys(e.names).reduce((e,t)=>({...e,[t]:!0}),{});function r(e){off(o,isTouchDevice()?"touchend":"mouseup",r),l&&(clearTimeout(l),l=null,function(e){let t=e.target,i=t.dataset.chart;if(!i)return;let l={...a,[i]:!a[i]};if(!Object.values(l).some(e=>e))return t.style.animationName=null,t.offsetWidth,void(t.style.animationName="shake");e.target.classList.toggle("m-hidden"),emit(n,"visibility-updated",a=l)}(e))}return Object.keys(e.names).forEach(n=>{let i=el("button"),l=el("div");add(i,l);const a=BUTTON_COLORS[e.colors[n]];i.style.borderColor=a,l.style.background=a;let r=svgEl("svg",{width:"18",height:"18",viewBox:"0 0 24 24"});add(r,svgEl("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}));let s=el("span");s.style.color=a,add(s,t(e.names[n])),add(i,r,s),i.dataset.chart=n,add(o,i)}),{buttons:o,visibilityMap:a}}function createChart(e,n){let i=d.getElementById("charts-container"),l=el("div","chart-wrapper"),o=el("h1");add(o,t("Chart #"+n)),add(l,o),e.y_scaled?createDoubleYLineChart(l,e):createLineChart(l,e),add(i,l)}function createSlider(e,t){let n,i=50,{slider:l,leftBar:o,rightBar:a}=function(){let e=el("div","slider"),t=el("div","slider__bar","left"),n=el("div","slider__bar","right");return{slider:e,leftBar:t,rightBar:n}}(),r=el("div","shadow","left"),s=el("div","shadow","right");on(t,"mousedown",v),on(t,"touchstart",v);let c,u,h,f=0,m=0,g={start:-1,end:-1};function v(e){let n=e.target,i=n===l?p:n===o||n===a?e=>(function(e,t){e.preventDefault();let n=y(e),i=h-n,l=t?Math.max(0,c-i):u,o=t?m:Math.max(0,f+i);C(l,o)&&(t?w(l):E(o),M())})(e,n===o):void 0;if(!i)return;h=y(e);let r=()=>{x(),off(t,"mousemove",i),off(t,"touchmove",i),off(d,"mouseup",r),off(d,"touchend",r)};on(t,"mousemove",i),on(t,"touchmove",i),on(d,"mouseup",r),on(d,"touchend",r)}function p(e){e.preventDefault();let t=y(e),n=h-t,i=c-n,l=f+n;C(i,l)&&(w(i),E(l),M())}function x(){C(u,m)&&(c=u,f=m)}function y(e){return e.touches?e.touches[0].clientX:e.clientX}function C(e,t){return e>=0&&t>=0&&n-e-t>=i}function w(e){u=e,A(r,e)}function E(e){m=e,A(s,e)}function A(e,t){e.style.width=`${t}px`}function M(){let i={start:Math.max(0,Math.round(u*e.length/n)),end:Math.min(e.length-1,Math.round((n-m)*(e.length-1)/n))};g.start===i.start&&g.end===i.end||(g=i,emit(t,"border-changed",i))}requestAnimationFrame(()=>{n=l.parentElement.getBoundingClientRect().width,u=n-i,E(m),w(u),x(),M()});let b=el("div","slider-container");return add(b,r,o,l,a,s),b}(()=>{let e="Switch to Night Mode",t="Switch to Day Mode",n=!1,i=d.getElementById("mode-switcher");on(i,"click",function(){d.body.classList.toggle("dark"),n=!n,i.innerText=n?t:e}),i.innerText=e})();